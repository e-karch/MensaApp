{
  "db_name": "PostgreSQL",
  "query": "\n            SELECT food_id \n            FROM food\n            WHERE similarity(name, $1) >= $5 AND food_type = $2 AND food_id NOT IN (SELECT food_id FROM meal)\n            AND food_id IN (\n                -- all food_id's with same allergens\n                SELECT food_id \n                FROM food_allergen FULL JOIN food USING (food_id)\n                GROUP BY food_id \n\t\t\t\tHAVING COALESCE(array_agg(allergen) FILTER (WHERE allergen IS NOT NULL), ARRAY[]::allergen[]) <@ $3::allergen[]\n\t\t\t\tAND COALESCE(array_agg(allergen) FILTER (WHERE allergen IS NOT NULL), ARRAY[]::allergen[]) @> $3::allergen[]\n            )\n            AND food_id IN (\n                -- all food_id's with same additives\n                SELECT food_id\n\t\t\t\tFROM food_additive FULL JOIN food USING (food_id)\n\t\t\t\tGROUP BY food_id \n\t\t\t\tHAVING COALESCE(array_agg(additive) FILTER (WHERE additive IS NOT NULL), ARRAY[]::additive[]) <@ $4::additive[]\n\t\t\t\tAND COALESCE(array_agg(additive) FILTER (WHERE additive IS NOT NULL), ARRAY[]::additive[]) @> $4::additive[]\n            )\n            ORDER BY similarity(name, $1) DESC\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "food_id",
        "type_info": "Uuid"
      }
    ],
    "parameters": {
      "Left": [
        "Text",
        {
          "Custom": {
            "name": "meal_type",
            "kind": {
              "Enum": [
                "VEGAN",
                "VEGETARIAN",
                "BEEF",
                "BEEF_AW",
                "PORK",
                "PORK_AW",
                "FISH",
                "UNKNOWN"
              ]
            }
          }
        },
        {
          "Custom": {
            "name": "_allergen",
            "kind": {
              "Array": {
                "Custom": {
                  "name": "allergen",
                  "kind": {
                    "Enum": [
                      "CA",
                      "DI",
                      "EI",
                      "ER",
                      "FI",
                      "GE",
                      "HF",
                      "HA",
                      "KA",
                      "KR",
                      "LU",
                      "MA",
                      "ML",
                      "PA",
                      "PE",
                      "PI",
                      "QU",
                      "RO",
                      "SA",
                      "SE",
                      "SF",
                      "SN",
                      "SO",
                      "WA",
                      "WE",
                      "WT",
                      "LA",
                      "GL"
                    ]
                  }
                }
              }
            }
          }
        },
        {
          "Custom": {
            "name": "_additive",
            "kind": {
              "Array": {
                "Custom": {
                  "name": "additive",
                  "kind": {
                    "Enum": [
                      "COLORANT",
                      "PRESERVING_AGENTS",
                      "ANTIOXIDANT_AGENTS",
                      "FLAVOUR_ENHANCER",
                      "PHOSPHATE",
                      "SURFACE_WAXED",
                      "SULPHUR",
                      "ARTIFICALLY_BLACKENED_OLIVES",
                      "SWEETENER",
                      "LAXATIVE_IF_OVERUSED",
                      "PHENYLALANINE",
                      "ALCOHOL",
                      "PRESSED_MEAT",
                      "GLAZING_WITH_CACAO",
                      "PRESSED_FISH"
                    ]
                  }
                }
              }
            }
          }
        },
        "Float4"
      ]
    },
    "nullable": [
      false
    ]
  },
  "hash": "f2c03bb5318a96d62eef79ca7a76aea188636a59c4c4465524cdd0a41807f50e"
}
